import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useCartStore } from '../../store/cartStore';
import './header.css';

function Header() {
  const navigate = useNavigate();
  const cartItemsCount = useCartStore((state) => state.getTotalItems());
  
  // Search state
  const [searchQuery, setSearchQuery] = useState<string>('');

  // Handle input change
  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setSearchQuery(e.target.value);
  };

  // Handle search execution
  const handleSearch = () => {
    const trimmedQuery = searchQuery.trim();
    
    if (trimmedQuery) {
      navigate(`/category?search=${encodeURIComponent(trimmedQuery)}`);
      setSearchQuery(''); // Clear input after navigation
    }
  };

  // Handle Enter key press
  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {
    if (e.key === 'Enter') {
      handleSearch();
    }
  };
  return (
    <header className="homepage-header">
        <div className="header-content">
          <p className="brand-logo" 
          onClick={()=>navigate('/#')}
          style={{cursor: "pointer"}}
          >SHOP.CO</p>
          <div className='nav-menu'>
            <div className='shop-dropdown-trigger'>
              <span className="shop-text">Shop</span>
              <svg className="shop-icon" width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11.2826 1.28318L6.28255 6.28318C6.21287 6.3531 6.13008 6.40857 6.03892 6.44643C5.94775 6.48428 5.85001 6.50377 5.7513 6.50377C5.65259 6.50377 5.55485 6.48428 5.46369 6.44643C5.37252 6.40857 5.28973 6.3531 5.22005 6.28318L0.220051 1.28318C0.0791548 1.14228 -2.09952e-09 0.951183 0 0.751926C2.09952e-09 0.552669 0.0791548 0.361572 0.220051 0.220676C0.360947 0.0797797 0.552044 0.000625136 0.751301 0.000625133C0.950558 0.000625131 1.14165 0.0797797 1.28255 0.220676L5.75193 4.69005L10.2213 0.220051C10.3622 0.079155 10.5533 0 10.7526 0C10.9518 0 11.1429 0.079155 11.2838 0.220051C11.4247 0.360948 11.5039 0.552044 11.5039 0.751301C11.5039 0.950559 11.4247 1.14165 11.2838 1.28255L11.2826 1.28318Z" fill="black" />
              </svg>
            </div>
            <ul className="nav-list">
              <li><a href='#' className="nav-link"> On Sale </a></li>
              <li><a  className="nav-link" onClick={() => navigate('/Category')}  style={{cursor: "pointer"}}> New Arrivals </a></li>
            </ul>
          </div>
          <div className='search-container'>
            <svg 
              className="search-icon" 
              width="21" 
              height="21" 
              viewBox="0 0 21 21" 
              fill="none" 
              xmlns="http://www.w3.org/2000/svg"
              onClick={handleSearch}
            >
              <path d="M19.9399 18.348L15.4877 13.8939C16.8226 12.1544 17.4458 9.97216 17.2309 7.78998C17.0161 5.60781 15.9792 3.58907 14.3306 2.14328C12.6821 0.697486 10.5453 -0.0670986 8.35376 0.00462578C6.16221 0.0763502 4.07999 0.979013 2.5295 2.5295C0.979013 4.07999 0.0763502 6.16221 0.00462578 8.35376C-0.0670986 10.5453 0.697486 12.6821 2.14328 14.3306C3.58907 15.9792 5.60781 17.0161 7.78998 17.2309C9.97216 17.4458 12.1544 16.8226 13.8939 15.4877L18.3499 19.9445C18.4545 20.0492 18.5787 20.1322 18.7155 20.1888C18.8522 20.2455 18.9987 20.2746 19.1467 20.2746C19.2947 20.2746 19.4413 20.2455 19.578 20.1888C19.7147 20.1322 19.839 20.0492 19.9436 19.9445C20.0482 19.8399 20.1313 19.7157 20.1879 19.5789C20.2445 19.4422 20.2737 19.2957 20.2737 19.1477C20.2737 18.9997 20.2445 18.8531 20.1879 18.7164C20.1313 18.5797 20.0482 18.4554 19.9436 18.3508L19.9399 18.348ZM2.26891 8.64392C2.26891 7.38306 2.6428 6.15052 3.3433 5.10215C4.04379 4.05379 5.03943 3.23669 6.20431 2.75418C7.36919 2.27167 8.65099 2.14543 9.88762 2.39141C11.1242 2.63739 12.2602 3.24455 13.1517 4.13611C14.0433 5.02767 14.6504 6.16359 14.8964 7.40021C15.1424 8.63684 15.0162 9.91864 14.5336 11.0835C14.0511 12.2484 13.234 13.244 12.1857 13.9445C11.1373 14.645 9.90477 15.0189 8.64392 15.0189C6.95369 15.0172 5.3332 14.345 4.13803 13.1498C2.94286 11.9546 2.27065 10.3341 2.26891 8.64392Z" fill="black" fill-opacity="0.4" />
            </svg>
            <input 
              type='text' 
              className='search-input' 
              placeholder='Search for products'
              value={searchQuery}
              onChange={handleSearchChange}
              onKeyDown={handleKeyDown}
            />
          </div>
          <div className='header-actions'>
            <div 
              className="cart-icon-wrapper"
              onClick={() => navigate('/cart')}
              style={{ cursor: 'pointer', position: 'relative' }}
            >
              <svg className="action-icon" width="23" height="21" viewBox="0 0 23 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.375 18.375C9.375 18.7458 9.26503 19.1084 9.059 19.4167C8.85298 19.725 8.56014 19.9654 8.21753 20.1073C7.87492 20.2492 7.49792 20.2863 7.1342 20.214C6.77049 20.1416 6.4364 19.963 6.17417 19.7008C5.91195 19.4386 5.73337 19.1045 5.66103 18.7408C5.58868 18.3771 5.62581 18.0001 5.76773 17.6575C5.90964 17.3149 6.14996 17.022 6.45831 16.816C6.76665 16.61 7.12916 16.5 7.5 16.5C7.99728 16.5 8.47419 16.6975 8.82582 17.0492C9.17745 17.4008 9.375 17.8777 9.375 18.375ZM17.25 16.5C16.8792 16.5 16.5166 16.61 16.2083 16.816C15.9 17.022 15.6596 17.3149 15.5177 17.6575C15.3758 18.0001 15.3387 18.3771 15.411 18.7408C15.4834 19.1045 15.662 19.4386 15.9242 19.7008C16.1864 19.963 16.5205 20.1416 16.8842 20.214C17.2479 20.2863 17.6249 20.2492 17.9675 20.1073C18.3101 19.9654 18.603 19.725 18.809 19.4167C19.015 19.1084 19.125 18.7458 19.125 18.375C19.125 17.8777 18.9275 17.4008 18.5758 17.0492C18.2242 16.6975 17.7473 16.5 17.25 16.5ZM22.0753 5.20594L19.5169 13.5216C19.3535 14.0593 19.0211 14.5301 18.569 14.864C18.1169 15.1979 17.5692 15.3771 17.0072 15.375H7.77469C7.2046 15.3732 6.65046 15.1866 6.1953 14.8433C5.74015 14.5001 5.40848 14.0186 5.25 13.4709L2.04469 2.25H1.125C0.826631 2.25 0.540483 2.13147 0.329505 1.9205C0.118526 1.70952 0 1.42337 0 1.125C0 0.826631 0.118526 0.540483 0.329505 0.329505C0.540483 0.118526 0.826631 0 1.125 0H2.32687C2.73407 0.00125797 3.12988 0.134515 3.45493 0.379779C3.77998 0.625044 4.01674 0.969093 4.12969 1.36031L4.81312 3.75H21C21.1761 3.74999 21.3497 3.7913 21.5069 3.87061C21.664 3.94992 21.8004 4.06501 21.905 4.20664C22.0096 4.34826 22.0795 4.51246 22.1091 4.68602C22.1387 4.85958 22.1271 5.03766 22.0753 5.20594ZM19.4766 6H5.45531L7.41375 12.8531C7.43617 12.9315 7.48354 13.0005 7.54867 13.0495C7.6138 13.0986 7.69315 13.1251 7.77469 13.125H17.0072C17.0875 13.1252 17.1656 13.0996 17.2303 13.052C17.2949 13.0044 17.3426 12.9373 17.3662 12.8606L19.4766 6Z" fill="black" />
              </svg>
              {cartItemsCount > 0 && (
                <span className="cart-badge">{cartItemsCount}</span>
              )}
            </div>
          </div>
        </div>
    </header>
  )
}

export default Header
